{% extends "base-editor.html" %}
{% load static %}
{% load cache_buster %}
{% block title %}
    {{ note.title }} - Notes
{% endblock title %}
{% block head %}
    <link rel="stylesheet" href="{% static_v 'css/app-notes.css' %}" />
{% endblock head %}
{% block content %}
    {% csrf_token %}
    <div class="note-editor-layout">
        <!-- Sidebar -->
        <aside class="note-sidebar">
            <div id="sidebar-list-container">{% include "notes/sidebar-list.html" %}</div>
        </aside>
        <!-- Main Editor Area -->
        <main class="note-main">
            <div class="note-toolbar-wrapper">
                <div class="note-toolbar">
                    <button class="panel-btn"
                            type="button"
                            onclick="togglePanel('note-sidebar')"
                            title="Toggle notes panel">
                        <i class="icon-panel-left"></i>
                    </button>
                    <div class="toolbar-left">
                        <a href="#" id="save-status-btn" title="Saved" onclick="return false;">
                            <i class="icon-cloud"></i>
                        </a>
                        <a href="#"
                           id="lock-toggle-btn"
                           style="display:none"
                           onclick="return false;">
                            <i class="icon-lock-open"></i>
                        </a>
                    </div>
                    <div class="toolbar-center"></div>
                    <div class="toolbar-right">
                        <a href="#" id="search-toggle-btn" title="Search & Replace (Ctrl+H)">
                            <i class="icon-search"></i>
                        </a>
                        <a href="#"
                           hx-get="{% url 'notes:note-import-modal' note.id %}"
                           hx-target="#htmx-modal-container"
                           title="Import from markdown">
                            <i class="icon-upload"></i>
                        </a>
                        <a href="#" id="export-btn" title="Export to markdown">
                            <i class="icon-download"></i>
                        </a>
                        <a href="#"
                           hx-get="{% url 'notes:notes-shortcuts' %}"
                           hx-target="#htmx-modal-container"
                           title="Keyboard shortcuts">
                            <i class="icon-keyboard"></i>
                        </a>
                    </div>
                    <button class="panel-btn"
                            type="button"
                            onclick="togglePanel('note-outline')"
                            title="Toggle outline panel">
                        <i class="icon-panel-right"></i>
                    </button>
                </div>
            </div>
            <!-- Search and Replace Bar -->
            <div id="search-replace-bar" class="search-replace-bar">
                <input type="text" id="search-input" placeholder="Find...">
                <input type="text" id="replace-input" placeholder="Replace with...">
                <span id="search-count"></span>
                <button type="button" id="search-prev" title="Previous match">
                    <i class="icon-chevron-up"></i>
                </button>
                <button type="button" id="search-next" title="Next match">
                    <i class="icon-chevron-down"></i>
                </button>
                <button type="button" id="replace-one" title="Replace">
                    <i class="icon-replace"></i>
                </button>
                <button type="button" id="replace-all" title="Replace All">
                    <i class="icon-replace-all"></i>
                </button>
                <button type="button" id="search-close" title="Close">
                    <i class="icon-x"></i>
                </button>
            </div>
            <div class="note-page standalone">
                <div id="note-editor-container">{% include "notes/editor-content.html" %}</div>
            </div>
        </main>
        <!-- Right Panel - Outline -->
        <aside class="note-outline">
            <div class="outline-header">
                <span>This Note</span>
                <button type="button"
                        class="panel-btn"
                        id="outline-collapse-btn"
                        title="Collapse/Expand all">
                    <i class="icon-chevrons-down-up"></i>
                </button>
            </div>
            <ul class="outline-list" id="outline-list">
            </ul>
        </aside>
    </div>
{% endblock content %}
{% block scripts %}
    <script type="module" src="{% static_v 'js/notes-editor.js' %}"></script>
{% endblock scripts %}
