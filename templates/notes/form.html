<div class="modal-dialog modal-md">
    <div class="modal-content">
        <div class="modal-header">
            <h1 class="modal-title">{{ action }} Note</h1>
            <a href="#" @click.prevent="$dispatch('close-modal')">
                <i class="icon-x"></i>
            </a>
        </div>
        <div class="modal-body">
            <form id="note-form"
                  hx-post="{% if note %}{% url 'notes:edit' note.id %}{% else %}{% url 'notes:add' %}{% endif %}"
                  hx-target="#htmx-modal-container"
                  class="form-compact col2">
                {% csrf_token %}
                {% if folders %}
                    <div class="form-group span2">
                        <label for="id_folder">Folder</label>
                        <div>
                            <select name="folder" id="id_folder">
                                <option value="">---------</option>
                                {% for folder in folders %}
                                    <option value="{{ folder.id }}"
                                            {% if form.instance.folder_id == folder.id or not form.instance.pk and folder.id == selected_folder_id %}selected{% endif %}>
                                        {{ folder.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                {% endif %}
                {{ form }}
                {% if note %}
                    <div class="form-group span2" style="margin-top:0.5rem">
                        <label>Encrypted</label>
                        <div style="display:flex;
                                    align-items:center;
                                    gap:0.5rem;
                                    color:var(--color-secondary);
                                    font-size:0.9rem">
                            {% if note.is_encrypted %}
                                <i class="icon-lock" style="font-size:0.9rem"></i> Yes
                            {% else %}
                                <i class="icon-lock-open" style="font-size:0.9rem"></i> No
                            {% endif %}
                            <span style="color:var(--color-muted);font-size:0.8rem">â€” Use the lock icon in the editor to change</span>
                        </div>
                    </div>
                {% endif %}
            </form>
        </div>
        <div class="modal-footer">
            {% if note %}
                <button type="button"
                        class="btn btn-danger"
                        hx-confirm="Are you sure you want to delete this note?"
                        hx-post="{% url 'notes:delete' note.id %}"
                        hx-target="#htmx-modal-container">Delete</button>
            {% else %}
                <button type="button"
                        class="btn btn-secondary"
                        @click="$dispatch('close-modal')">Cancel</button>
            {% endif %}
            <button type="submit" form="note-form" class="btn btn-primary">Submit</button>
        </div>
    </div>
</div>
